# poly-maker æ•°æ®åº“ç»“æ„è¯¦æ

> é¡¹ç›®ï¼šwarproxxx/poly-maker (GitHub Stars: 792)
> 
> ç±»å‹ï¼šPolymarket åšå¸‚å•†æœºå™¨äºº
> 
> æ•°æ®æºï¼šCodeLib/00017

---

## ğŸ“Š æ•°æ®åº“æ¶æ„æ¦‚è§ˆ

poly-maker é‡‡ç”¨ **"äº‘ç«¯è¡¨æ ¼ + æœ¬åœ°æ–‡ä»¶ + å†…å­˜çŠ¶æ€"** ä¸‰å±‚æ¶æ„ï¼š

| å±‚çº§ | å­˜å‚¨ä»‹è´¨ | ç”¨é€” | æŒä¹…åŒ– |
|:-----|:---------|:-----|:------:|
| **äº‘ç«¯** | Google Sheets (6å·¥ä½œè¡¨) | å¸‚åœºé…ç½®ã€äº¤æ˜“å‚æ•°ã€ç»Ÿè®¡æ±‡æ€» | âœ… æŒä¹…åŒ– |
| **æœ¬åœ°** | JSON + CSV æ–‡ä»¶ | é£é™©çŠ¶æ€ã€ä»·æ ¼å†å² | âœ… æŒä¹…åŒ– |
| **å†…å­˜** | Python å…¨å±€å˜é‡ | å®æ—¶çŠ¶æ€ã€ç¼“å­˜ | âŒ æ˜“å¤± |

---

## â˜ï¸ ç¬¬ä¸€å±‚ï¼šGoogle Sheets äº‘ç«¯æ•°æ®åº“

### å·¥ä½œè¡¨ 1ï¼šAll Marketsï¼ˆæ‰€æœ‰å¸‚åœºè¡¨ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨æ‰€æœ‰æ£€æµ‹åˆ°çš„ Polymarket å¸‚åœºæ•°æ®

**å­—æ®µç»“æ„**ï¼š

| å­—æ®µå | æ•°æ®ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|:-------|:---------|:-----|:-----|
| question | string | å¸‚åœºé—®é¢˜/æ ‡é¢˜ | "Will Biden win 2024?" |
| answer1 | string | ç»“æœ1ç­”æ¡ˆ | "Yes" |
| answer2 | string | ç»“æœ2ç­”æ¡ˆ | "No" |
| spread | float | ä¹°å–ä»·å·® | 0.02 |
| rewards_daily_rate | float | æ—¥å¥–åŠ±ç‡ | 0.5 |
| gm_reward_per_100 | float | å‡ ä½•å¹³å‡å¥–åŠ±/100 | 2.5 |
| sm_reward_per_100 | float | ç®—æœ¯å¹³å‡å¥–åŠ±/100 | 2.3 |
| bid_reward_per_100 | float | ä¹°æ–¹å¥–åŠ±/100 | 2.1 |
| ask_reward_per_100 | float | å–æ–¹å¥–åŠ±/100 | 2.4 |
| volatility_sum | float | æ³¢åŠ¨ç‡æ€»å’Œ | 15.6 |
| volatilty/reward | string | æ³¢åŠ¨ç‡/å¥–åŠ±æ¯”ç‡ | "6.24" |
| min_size | float | æœ€å°è®¢å• size | 5.0 |
| max_spread | float | æœ€å¤§ spread é™åˆ¶ | 0.1 |
| tick_size | float | ä»·æ ¼æœ€å°å˜åŠ¨å•ä½ | 0.01 |
| 1_hour | float | 1å°æ—¶å¹´åŒ–æ³¢åŠ¨ç‡ | 12.5 |
| 3_hour | float | 3å°æ—¶å¹´åŒ–æ³¢åŠ¨ç‡ | 15.2 |
| 6_hour | float | 6å°æ—¶å¹´åŒ–æ³¢åŠ¨ç‡ | 18.1 |
| 12_hour | float | 12å°æ—¶å¹´åŒ–æ³¢åŠ¨ç‡ | 20.3 |
| 24_hour | float | 24å°æ—¶å¹´åŒ–æ³¢åŠ¨ç‡ | 22.8 |
| 7_day | float | 7å¤©å¹´åŒ–æ³¢åŠ¨ç‡ | 45.2 |
| 30_day | float | 30å¤©å¹´åŒ–æ³¢åŠ¨ç‡ | 78.9 |
| best_bid | float | æœ€ä½³ä¹°ä»· | 0.45 |
| best_ask | float | æœ€ä½³å–ä»· | 0.47 |
| volatility_price | float | æ³¢åŠ¨ç‡è®¡ç®—åŸºå‡†ä»· | 0.46 |
| neg_risk | boolean | è´Ÿé£é™©å¸‚åœºæ ‡è®° | "TRUE"/"FALSE" |
| market_slug | string | å¸‚åœº URL æ ‡è¯† | "biden-win-2024" |
| token1 | string | YES ä»£å¸ID | "123456..." |
| token2 | string | NO ä»£å¸ID | "789012..." |
| condition_id | string | å¸‚åœºæ¡ä»¶IDï¼ˆä¸»é”®ï¼‰ | "0xabc..." |

---

### å·¥ä½œè¡¨ 2ï¼šVolatility Marketsï¼ˆæ³¢åŠ¨ç‡å¸‚åœºè¡¨ï¼‰

**ç”¨é€”**ï¼šç­›é€‰ä½æ³¢åŠ¨ç‡å¸‚åœºï¼ˆ`volatility_sum < 20`ï¼‰

**æ•°æ®ç»“æ„**ï¼š
- åŒ All Markets
- é€šè¿‡ç­›é€‰æ¡ä»¶ `volatility_sum < 20` ç”Ÿæˆ
- æŒ‰ `gm_reward_per_100` é™åºæ’åˆ—

---

### å·¥ä½œè¡¨ 3ï¼šFull Marketsï¼ˆå®Œæ•´å¸‚åœºè¡¨ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨é€‰ä¸­çš„äº¤æ˜“å¸‚åœºå®Œæ•´é…ç½®

**æ ¸å¿ƒå­—æ®µ**ï¼š

| å­—æ®µå | æ•°æ®ç±»å‹ | è¯´æ˜ |
|:-------|:---------|:-----|
| question | string | å¸‚åœºé—®é¢˜ |
| answer1 | string | ç»“æœ1 |
| answer2 | string | ç»“æœ2 |
| neg_risk | string | è´Ÿé£é™©æ ‡è®° "TRUE"/"FALSE" |
| spread | float | å½“å‰ spread |
| best_bid | float | æœ€ä½³ä¹°ä»· |
| best_ask | float | æœ€ä½³å–ä»· |
| rewards_daily_rate | float | æ—¥å¥–åŠ±ç‡ |
| bid_reward_per_100 | float | ä¹°æ–¹å¥–åŠ± |
| ask_reward_per_100 | float | å–æ–¹å¥–åŠ± |
| gm_reward_per_100 | float | å‡ ä½•å¹³å‡å¥–åŠ± |
| sm_reward_per_100 | float | ç®—æœ¯å¹³å‡å¥–åŠ± |
| min_size | float | æœ€å°è®¢å• size |
| max_spread | float | æœ€å¤§ spread |
| tick_size | float | ä»·æ ¼ç²¾åº¦ |
| market_slug | string | å¸‚åœºæ ‡è¯† |
| token1 | string | ä»£å¸1 ID |
| token2 | string | ä»£å¸2 ID |
| condition_id | string | æ¡ä»¶IDï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰ |

**ä¸å…¶ä»–è¡¨çš„å…³ç³»**ï¼š
```
Full Markets = Selected Markets + (All Markets âˆ© ç­›é€‰æ¡ä»¶)
```

---

### å·¥ä½œè¡¨ 4ï¼šSelected Marketsï¼ˆé€‰ä¸­å¸‚åœºè¡¨ï¼‰

**ç”¨é€”**ï¼šç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©è¦äº¤æ˜“çš„å¸‚åœº

**å­—æ®µ**ï¼šåŒ Full Markets

**ç‰¹æ®Šæ ‡è®°**ï¼š
- `multiplier` (å¯é€‰)ï¼šè‡ªå®šä¹‰ä¹˜æ•°
- ç©ºè¡Œè¡¨ç¤ºæœªé€‰ä¸­

---

### å·¥ä½œè¡¨ 5ï¼šHyperparametersï¼ˆè¶…å‚æ•°è¡¨ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨äº¤æ˜“ç­–ç•¥å‚æ•°é…ç½®

**å­—æ®µç»“æ„**ï¼š

| å­—æ®µå | æ•°æ®ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|:-------|:---------|:-----|:-----|
| type | string | å‚æ•°ç±»åˆ« | "default", "aggressive", "conservative" |
| param | string | å‚æ•°å | "stop_loss_threshold" |
| value | float/string | å‚æ•°å€¼ | -5.0, 0.03, 3 |

**æ ¸å¿ƒå‚æ•°è¯´æ˜**ï¼š

| param | é»˜è®¤å€¼ | è¯´æ˜ |
|:------|:-------|:-----|
| stop_loss_threshold | -5.0 | æ­¢æŸé˜ˆå€¼ï¼ˆ%ï¼‰ |
| take_profit_threshold | 3.0 | æ­¢ç›ˆé˜ˆå€¼ï¼ˆ%ï¼‰ |
| spread_threshold | 0.03 | æœ€å¤§å¯æ¥å— spread |
| volatility_threshold | 25.0 | æœ€å¤§æ³¢åŠ¨ç‡é˜ˆå€¼ |
| sleep_period | 3.0 | æ­¢æŸåä¼‘çœ æ—¶é—´ï¼ˆå°æ—¶ï¼‰ |
| trade_size | 50.0 | é»˜è®¤äº¤æ˜“ size |

---

### å·¥ä½œè¡¨ 6ï¼šSummaryï¼ˆæ±‡æ€»è¡¨ï¼‰

**ç”¨é€”**ï¼šè´¦æˆ·ç»Ÿè®¡å’ŒæŒä»“æ±‡æ€»å±•ç¤º

**å­—æ®µç»“æ„**ï¼š

| å­—æ®µå | æ•°æ®ç±»å‹ | è¯´æ˜ |
|:-------|:---------|:-----|
| question | string | å¸‚åœºé—®é¢˜ |
| answer | string | æŒä»“æ–¹å‘ï¼ˆYES/NOï¼‰ |
| order_size | float | æŒ‚å•æ•°é‡ |
| position_size | float | æŒä»“æ•°é‡ |
| marketInSelected | boolean | æ˜¯å¦åœ¨é€‰ä¸­å¸‚åœºåˆ—è¡¨ |
| earnings | float | ç´¯è®¡æ”¶ç›Š |
| earning_percentage | float | æ”¶ç›Šç‡ï¼ˆ%ï¼‰ |

---

## ğŸ’¾ ç¬¬äºŒå±‚ï¼šæœ¬åœ°æ–‡ä»¶å­˜å‚¨

### ç›®å½•ç»“æ„

```
poly-maker/
â”œâ”€â”€ positions/              # é£é™©ç®¡ç†çŠ¶æ€æ–‡ä»¶
â”‚   â””â”€â”€ {condition_id}.json # æ¯ä¸ªå¸‚åœºçš„é£é™©çŠ¶æ€
â”œâ”€â”€ data/                   # ä»·æ ¼å†å²ç¼“å­˜
â”‚   â””â”€â”€ {token_id}.csv      # æ¯ä¸ªä»£å¸çš„ä»·æ ¼æ•°æ®
â””â”€â”€ credentials.json        # Google Sheets API å‡­è¯
```

---

### positions/ ç›®å½•ï¼ˆJSON æ–‡ä»¶ï¼‰

**æ–‡ä»¶åæ ¼å¼**ï¼š`positions/{condition_id}.json`

**JSON ç»“æ„**ï¼š
```json
{
  "time": "2024-01-15T08:30:00",
  "question": "Will Biden win 2024?",
  "msg": "Selling 10.0 because spread is 0.02 and pnl is -5.2 and ratio is 1.5 and 3 hour volatility is 30.5",
  "sleep_till": "2024-01-15T11:30:00"
}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|:-------|:-----|:-----|
| time | ISO datetime | é£é™©äº‹ä»¶è§¦å‘æ—¶é—´ |
| question | string | å¸‚åœºé—®é¢˜ï¼ˆå†—ä½™ï¼Œä¾¿äºæŸ¥çœ‹ï¼‰ |
| msg | string | é£é™©è§¦å‘è¯¦ç»†ä¿¡æ¯ |
| sleep_till | ISO datetime | æ¢å¤äº¤æ˜“æ—¶é—´ |

**ä¸šåŠ¡é€»è¾‘**ï¼š
- å½“è§¦å‘æ­¢æŸæ—¶åˆ›å»ºæ­¤æ–‡ä»¶
- åœ¨ `sleep_till` æ—¶é—´ä¹‹å‰ç¦æ­¢æ–°çš„ä¹°å…¥è®¢å•
- æ–‡ä»¶å­˜åœ¨å³è¡¨ç¤ºå¤„äº"é£é™©å…³é—­"çŠ¶æ€

---

### data/ ç›®å½•ï¼ˆCSV æ–‡ä»¶ï¼‰

**æ–‡ä»¶åæ ¼å¼**ï¼š`data/{token_id}.csv`

**CSV ç»“æ„**ï¼š

| åˆ—å | ç±»å‹ | è¯´æ˜ |
|:-----|:-----|:-----|
| t | datetime | æ—¶é—´æˆ³ |
| p | float | ä»·æ ¼ |
| log_return | float | å¯¹æ•°æ”¶ç›Šç‡ |

**æ•°æ®ç¤ºä¾‹**ï¼š
```csv
t,p,log_return
2024-01-15 08:00:00,0.45,
2024-01-15 08:01:00,0.451,0.002218
2024-01-15 08:02:00,0.449,-0.004454
```

**ç”¨é€”**ï¼š
- è®¡ç®—å¤šæ—¶é—´æ®µæ³¢åŠ¨ç‡ï¼ˆ1h/3h/6h/12h/24h/7d/30dï¼‰
- ä»·æ ¼å†å²ç¼“å­˜ï¼Œå‡å°‘ API è°ƒç”¨

---

## ğŸ§  ç¬¬ä¸‰å±‚ï¼šå†…å­˜æ•°æ®ç»“æ„

### å…¨å±€çŠ¶æ€ï¼ˆglobal_state.pyï¼‰

```python
# ============ å¸‚åœºæ•°æ® ============
all_tokens: list[str] = []              # æ‰€æœ‰è¿½è¸ªçš„ä»£å¸åˆ—è¡¨
REVERSE_TOKENS: dict[str, str] = {}     # ä»£å¸æ˜ å°„ï¼ˆYES <-> NOï¼‰
all_data: dict = {}                     # è®¢å•ç°¿æ•°æ®
df: pd.DataFrame | None = None          # å¸‚åœºé…ç½® DataFrame

# ============ å®¢æˆ·ç«¯ä¸å‚æ•° ============
client: ClobClient | None = None        # Polymarket API å®¢æˆ·ç«¯
params: dict[str, dict] = {}            # äº¤æ˜“å‚æ•° {type: {param: value}}
lock: threading.Lock                    # çº¿ç¨‹å®‰å…¨é”

# ============ äº¤æ˜“çŠ¶æ€ ============
performing: dict[str, set] = {}         # å¾…å¤„ç†äº¤æ˜“ {token_side: {trade_ids}}
performing_timestamps: dict = {}        # äº¤æ˜“æ—¶é—´æˆ³
last_trade_update: dict[str, float] = {} # æœ€åäº¤æ˜“æ›´æ–°ï¼ˆtime.time()ï¼‰
orders: dict[str, dict] = {}            # å½“å‰è®¢å•
positions: dict[str, dict] = {}         # å½“å‰æŒä»“
```

---

### æ•°æ®ç»“æ„è¯¦è§£

#### 1. REVERSE_TOKENSï¼ˆä»£å¸æ˜ å°„ï¼‰
```python
{
  "123456...": "789012...",  # token1 (YES) -> token2 (NO)
  "789012...": "123456..."   # token2 (NO) -> token1 (YES)
}
```

#### 2. ordersï¼ˆè®¢å•çŠ¶æ€ï¼‰
```python
{
  "123456...": {
    "buy": {"price": 0.45, "size": 10.0},
    "sell": {"price": 0.0, "size": 0.0}
  }
}
```

#### 3. positionsï¼ˆæŒä»“çŠ¶æ€ï¼‰
```python
{
  "123456...": {
    "size": 25.0,      # æ­£æ•°=å¤šå¤´ï¼Œè´Ÿæ•°=ç©ºå¤´
    "avgPrice": 0.46   # å¹³å‡æˆæœ¬ä»·
  }
}
```

#### 4. performingï¼ˆå¾…å¤„ç†äº¤æ˜“ï¼‰
```python
{
  "123456..._buy": {trade_id1, trade_id2},
  "123456..._sell": {trade_id3}
}
```

---

## ğŸ”„ æ•°æ®æµè½¬å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Google Sheets                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ All Markets â”‚  â”‚Volatility   â”‚  â”‚ Full Markets            â”‚  â”‚
â”‚  â”‚ (åŸå§‹æ•°æ®)   â”‚  â”‚Markets      â”‚  â”‚ (é€‰ä¸­å¸‚åœºå®Œæ•´æ•°æ®)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                      â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Selected     â”‚  â”‚ Hyperparameters                           â”‚  â”‚
â”‚  â”‚Markets      â”‚  â”‚ (äº¤æ˜“ç­–ç•¥å‚æ•°)                              â”‚  â”‚
â”‚  â”‚ (ç”¨æˆ·é€‰æ‹©)  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ å®šæœŸåŒæ­¥ (update_markets.py)
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å†…å­˜çŠ¶æ€ (Python)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ df           â”‚  â”‚ params       â”‚  â”‚ positions            â”‚  â”‚
â”‚  â”‚ (å¸‚åœºDataFrame)â”‚ â”‚ (äº¤æ˜“å‚æ•°)    â”‚  â”‚ (æŒä»“çŠ¶æ€)            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                       â”‚               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ orders       â”‚  â”‚ performing / performing_timestamps    â”‚    â”‚
â”‚  â”‚ (å½“å‰è®¢å•)    â”‚  â”‚ (å¾…å¤„ç†äº¤æ˜“)                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ äº¤æ˜“æ‰§è¡Œ (trading.py)
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ positions/                       â”‚  â”‚ data/                â”‚ â”‚
â”‚  â”‚ â”œâ”€â”€ {condition_id}.json          â”‚  â”‚ â”œâ”€â”€ {token1}.csv     â”‚ â”‚
â”‚  â”‚ â””â”€â”€ ... (é£é™©çŠ¶æ€æ–‡ä»¶)            â”‚  â”‚ â”œâ”€â”€ {token2}.csv     â”‚ â”‚
â”‚  â”‚                                  â”‚  â”‚ â””â”€â”€ ... (ä»·æ ¼å†å²)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ æ ¸å¿ƒæ•°æ®å…³ç³»

### ä¸»é”®æ˜ å°„å…³ç³»

```
condition_id (å¸‚åœºå”¯ä¸€æ ‡è¯†)
    â”œâ”€â”€ token1 (YES ä»£å¸)
    â”œâ”€â”€ token2 (NO ä»£å¸)
    â”œâ”€â”€ market_slug (URL æ ‡è¯†)
    â””â”€â”€ positions/{condition_id}.json (é£é™©çŠ¶æ€æ–‡ä»¶)

REVERSE_TOKENS åŒå‘æ˜ å°„:
    token1 <-> token2
```

### æ•°æ®æ›´æ–°é¢‘ç‡

| æ•°æ®æº | æ›´æ–°é¢‘ç‡ | è§¦å‘æ–¹å¼ |
|:-------|:---------|:---------|
| All Markets | æ¯å°æ—¶ | å®šæ—¶ä»»åŠ¡ (update_markets.py) |
| Volatility Markets | æ¯å°æ—¶ | All Markets ç­›é€‰åæ›´æ–° |
| Full Markets | æ¯å°æ—¶ | åˆå¹¶ Selected + All åæ›´æ–° |
| positions/*.json | è§¦å‘å¼ | æ­¢æŸæ—¶åˆ›å»ºï¼Œä¼‘çœ æœŸæ»¡ååˆ é™¤ |
| data/*.csv | æ¯å°æ—¶ | æ³¢åŠ¨ç‡è®¡ç®—æ—¶æ›´æ–° |
| å†…å­˜çŠ¶æ€ | å®æ—¶ | WebSocket æ¨é€/API è½®è¯¢ |

---

## ğŸ“‹ æ•°æ®å­—æ®µå¯¹ç…§è¡¨

### Gamma API å­—æ®µ -> Google Sheets å­—æ®µæ˜ å°„

| Gamma API å­—æ®µ | Sheets å­—æ®µ | è¯´æ˜ |
|:---------------|:------------|:-----|
| question | question | å¸‚åœºé—®é¢˜ |
| tokens[0].outcome | answer1 | ç»“æœ1 |
| tokens[1].outcome | answer2 | ç»“æœ2 |
| tokens[0].token_id | token1 | ä»£å¸1 ID |
| tokens[1].token_id | token2 | ä»£å¸2 ID |
| condition_id | condition_id | æ¡ä»¶ID |
| rewards.min_size | min_size | æœ€å°è®¢å• |
| rewards.max_spread | max_spread | æœ€å¤§ spread |
| minimum_tick_size | tick_size | ä»·æ ¼ç²¾åº¦ |
| neg_risk | neg_risk | è´Ÿé£é™©æ ‡è®° |
| market_slug | market_slug | URL æ ‡è¯† |

---

## ğŸ’¡ PolyOMB å€Ÿé‰´å»ºè®®

### å¯ç›´æ¥å¤ç”¨çš„è¡¨ç»“æ„è®¾è®¡

#### 1. markets è¡¨ï¼ˆå¯¹åº” Full Marketsï¼‰
```sql
CREATE TABLE markets (
    id SERIAL PRIMARY KEY,
    condition_id VARCHAR(66) UNIQUE NOT NULL,
    question TEXT,
    answer1 VARCHAR(255),
    answer2 VARCHAR(255),
    token1 VARCHAR(255),
    token2 VARCHAR(255),
    neg_risk BOOLEAN DEFAULT FALSE,
    -- ä»·æ ¼æ•°æ®
    best_bid NUMERIC(10,6),
    best_ask NUMERIC(10,6),
    spread NUMERIC(10,6),
    -- å¥–åŠ±æ•°æ®
    rewards_daily_rate NUMERIC(10,6),
    gm_reward_per_100 NUMERIC(10,6),
    min_size NUMERIC(10,6),
    max_spread NUMERIC(10,6),
    tick_size NUMERIC(10,6),
    -- æ³¢åŠ¨ç‡æ•°æ®
    volatility_1h NUMERIC(10,6),
    volatility_3h NUMERIC(10,6),
    volatility_24h NUMERIC(10,6),
    volatility_7d NUMERIC(10,6),
    -- å…ƒæ•°æ®
    market_slug VARCHAR(255),
    active BOOLEAN DEFAULT TRUE,
    updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 2. trading_params è¡¨ï¼ˆå¯¹åº” Hyperparametersï¼‰
```sql
CREATE TABLE trading_params (
    id SERIAL PRIMARY KEY,
    param_type VARCHAR(50) DEFAULT 'default', -- 'default', 'aggressive', 'conservative'
    param_name VARCHAR(100) NOT NULL,
    param_value NUMERIC(20,10) NOT NULL,
    description TEXT,
    updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 3. risk_events è¡¨ï¼ˆå¯¹åº” positions/*.jsonï¼‰
```sql
CREATE TABLE risk_events (
    id SERIAL PRIMARY KEY,
    condition_id VARCHAR(66) REFERENCES markets(condition_id),
    event_type VARCHAR(50), -- 'stop_loss', 'take_profit'
    triggered_at TIMESTAMPTZ,
    sleep_until TIMESTAMPTZ,
    message TEXT,
    pnl_percent NUMERIC(10,6),
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## ğŸ“š å‚è€ƒæ–‡ä»¶è·¯å¾„

| åŠŸèƒ½ | ä»£ç æ–‡ä»¶ | å…³é”®å‡½æ•° |
|:-----|:---------|:---------|
| Google Sheets è¯»å– | `poly_utils/google_utils.py` | `get_spreadsheet()` |
| å¸‚åœºæ•°æ®æ›´æ–° | `update_markets.py` | `fetch_and_process_data()` |
| äº¤æ˜“æ‰§è¡Œ | `trading.py` | `perform_trade()` |
| æŒä»“ç®¡ç† | `poly_data/data_utils.py` | `set_position()`, `get_position()` |
| çŠ¶æ€ç®¡ç† | `poly_data/global_state.py` | å…¨å±€å˜é‡å®šä¹‰ |
| æ•°æ®ç»Ÿè®¡ | `poly_stats/account_stats.py` | `update_stats_once()` |

---

*æ–‡æ¡£ç”Ÿæˆæ—¶é—´ï¼š2026-02-16*
*åŸºäºæºä»£ç ç‰ˆæœ¬ï¼špoly-maker (warproxxx/poly-maker)*
