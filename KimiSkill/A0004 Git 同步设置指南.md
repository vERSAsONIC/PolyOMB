# Git 同步设置指南

> 完整教程：将角色系统托管到 Git，实现多设备同步

---

## 📚 原理详解

### 为什么用 Git 同步？

**Git 是什么？**
Git 是一个分布式版本控制系统，简单说就是：
- 记录文件的每一次修改
- 可以在多台电脑间同步
- 可以回溯到任意历史版本

**用 Git 同步角色的好处：**

```
┌─────────────┐      push      ┌─────────────┐
│   电脑 A    │ ─────────────→ │  GitHub仓库  │
│ (家里电脑)   │                │  (云端备份)  │
└─────────────┘                └─────────────┘
                                     ↑
                                     │ pull
                               ┌─────────────┐
                               │   电脑 B    │
                               │ (公司电脑)   │
                               └─────────────┘
```

| 优势 | 说明 |
|------|------|
| 🔄 **自动版本控制** | 每次修改都有记录，可随时回滚 |
| ☁️ **云端备份** | GitHub/GitLab 免费托管，不怕丢失 |
| 🖥️ **多设备同步** | 家里、公司、笔记本都能用同一套角色 |
| 👥 **团队协作** | 可以和朋友分享，共同维护 |
| 📝 **修改记录** | 清楚知道什么时候改了什么 |

---

### 核心概念

#### 1. 工作区（Working Directory）

就是 `~/.config/agents/skills/` 这个文件夹里的实际文件。

```
~/.config/agents/skills/
├── role-orchestrator/SKILL.md      ← 你在编辑这个
├── role-researcher/SKILL.md
└── role-doc-writer/SKILL.md
```

#### 2. 暂存区（Staging Area）

准备提交的文件列表。相当于"购物车"，你可以：
- 把修改的文件加入购物车（`git add`）
- 从购物车移除（`git reset`）

#### 3. 本地仓库（Local Repository）

提交后的历史记录，保存在 `.git` 隐藏文件夹里。

```bash
cd ~/.config/agents/skills
git commit -m "修改了文档作者角色"
# 这次修改就被记录到本地历史了
```

#### 4. 远程仓库（Remote Repository）

GitHub/GitLab 上的云端仓库。

```bash
git push origin main
# 把本地修改推送到 GitHub
```

#### 5. 完整的 Git 工作流

```
编辑文件 → git add → git commit → git push
    ↑                                    ↓
    └──────── git pull ←───────────────┘
```

| 命令 | 作用 | 比喻 |
|------|------|------|
| `git add` | 把修改加入暂存区 | 加入购物车 |
| `git commit` | 保存到本地历史 | 确认订单 |
| `git push` | 上传到云端 | 发货 |
| `git pull` | 从云端下载更新 | 收货 |
| `git clone` | 第一次下载整个仓库 | 搬家 |

---

## 🚀 设置步骤

### 第一步：检查 Git 是否安装

```bash
git --version
# 应该显示类似：git version 2.39.0

# 如果没安装：
# macOS: brew install git
# Ubuntu: sudo apt install git
# Windows: 下载 Git for Windows
```

**如果遇到 Xcode 许可问题：**
```bash
sudo xcodebuild -license
# 按空格阅读，输入 agree 同意
```

---

### 第二步：初始化本地仓库

```bash
# 进入 skills 目录
cd ~/.config/agents/skills

# 初始化 Git 仓库
git init

# 你会看到：Initialized empty Git repository in ...
```

---

### 第三步：配置 Git 用户信息

```bash
# 配置你的姓名和邮箱（用于提交记录）
git config user.name "你的名字"
git config user.email "your.email@example.com"

# 验证配置
git config --list
```

---

### 第四步：添加文件并提交

```bash
cd ~/.config/agents/skills

# 1. 查看当前状态
git status
# 应该显示很多 "Untracked files"（未跟踪的文件）

# 2. 添加所有文件到暂存区
git add .

# 3. 提交到本地仓库
git commit -m "Initial commit: 添加 7 个角色

- role-orchestrator: 角色调度员
- role-researcher: 项目研究员
- role-code-reviewer: 代码审查员
- role-doc-writer: 文档作者
- role-skill-writer: Skill 作者
- role-mode-writer: Mode 作者
- role-architect: 架构师"

# 4. 查看提交历史
git log --oneline
```

---

### 第五步：创建 GitHub 仓库

#### 5.1 注册/登录 GitHub
访问 https://github.com 注册账号（如果还没有）

#### 5.2 创建新仓库

1. 点击右上角 **+** → **New repository**
2. **Repository name**: `kimi-roles`（或你喜欢的名字）
3. **Description**: 我的 Kimi CLI 角色集合
4. 选择 **Public**（公开）或 **Private**（私有）
5. **不要**勾选 "Initialize this repository with a README"
6. 点击 **Create repository**

#### 5.3 连接本地仓库到 GitHub

创建仓库后，GitHub 会显示类似下面的命令：

```bash
# 在本地执行这些命令
cd ~/.config/agents/skills

# 添加远程仓库（用你的实际用户名替换）
git remote add origin https://github.com/YOUR_USERNAME/kimi-roles.git

# 推送到 GitHub
git branch -M main
git push -u origin main

# 输入你的 GitHub 用户名和密码/Token
```

**关于密码：**
- GitHub 已不支持直接用密码
- 需要创建 Personal Access Token
- 访问 https://github.com/settings/tokens → Generate new token
- 勾选 "repo" 权限，生成 Token 后用作密码

---

### 第六步：验证推送成功

打开浏览器访问：
```
https://github.com/YOUR_USERNAME/kimi-roles
```

应该能看到所有角色文件夹！

---

## 🔄 日常使用流程

### 在本机修改角色后

```bash
cd ~/.config/agents/skills

# 1. 查看修改了哪些文件
git status

# 2. 添加修改的文件
git add role-doc-writer/SKILL.md

# 或者添加所有修改
git add .

# 3. 提交修改（写清楚改了什么）
git commit -m "优化文档作者角色的写作模板

- 添加了 API 文档模板
- 优化了 README 结构
- 修复了语法错误"

# 4. 推送到 GitHub
git push
```

---

### 在新电脑上获取角色

```bash
# 1. 删除默认的 skills 目录（如果有）
rm -rf ~/.config/agents/skills

# 2. 从 GitHub 克隆
# 方式 A：HTTPS（需要用户名密码/Token）
git clone https://github.com/YOUR_USERNAME/kimi-roles.git ~/.config/agents/skills

# 方式 B：SSH（需要配置 SSH 密钥，更方便）
git clone git@github.com:YOUR_USERNAME/kimi-roles.git ~/.config/agents/skills

# 3. 验证
ls ~/.config/agents/skills/
kimi --skill role-orchestrator
```

---

### 在其他电脑上同步更新

```bash
cd ~/.config/agents/skills

# 拉取最新更改
git pull

# 开始使用更新后的角色
kimi --skill role-researcher
```

---

## 🆘 常见问题解决

### Q1: push 时提示 "rejected"

**原因**：远程仓库有更新，本地不是最新的

**解决**：
```bash
git pull origin main   # 先拉取更新
git push              # 再推送
```

### Q2: pull 时提示 "conflict"

**原因**：本地和远程都修改了同一文件的同一位置

**解决**：
```bash
# 1. 手动编辑冲突文件，保留你想要的修改
# 2. 添加解决后的文件
git add .

# 3. 提交解决
git commit -m "解决合并冲突"

# 4. 推送
git push
```

### Q3: 忘记提交，换电脑后工作丢了？

**预防**：养成好习惯，修改后立即 commit + push

**如果已经丢失**：
```bash
# 在本机查看提交历史，找回代码
git log --all --full-history -- "**/SKILL.md"
```

### Q4: 不想把所有修改都 push

```bash
# 查看具体修改了哪些内容
git diff

# 只添加特定文件
git add role-doc-writer/SKILL.md

# 其他修改可以暂存
git stash

# 之后恢复暂存
git stash pop
```

---

## 🎯 高级技巧

### 技巧 1：分支管理（多人协作）

```bash
# 创建开发分支
git checkout -b develop

# 在 develop 分支修改
git add .
git commit -m "添加新角色"
git push origin develop

# 测试没问题后，合并到 main
git checkout main
git merge develop
git push
```

### 技巧 2：标签发布（版本管理）

```bash
# 给重要版本打标签
git tag -a v1.0 -m "第一个稳定版本"
git push origin v1.0

# 之后可以回滚到特定版本
git checkout v1.0
```

### 技巧 3：忽略不需要的文件

```bash
# 创建 .gitignore
echo "*.log
.DS_Store
*.tmp" > ~/.config/agents/skills/.gitignore

git add .gitignore
git commit -m "添加 gitignore"
git push
```

---

## 📋 命令速查表

| 场景 | 命令 |
|------|------|
| **初始化** | `git init` |
| **查看状态** | `git status` |
| **添加文件** | `git add filename` 或 `git add .` |
| **提交** | `git commit -m "描述"` |
| **推送到云端** | `git push` |
| **拉取更新** | `git pull` |
| **克隆仓库** | `git clone <url> <目标目录>` |
| **查看历史** | `git log --oneline` |
| **查看修改** | `git diff` |

---

## 🎓 Git 工作原理图解

```
本地电脑                              GitHub 云端
┌─────────────────┐                  ┌──────────────┐
│   Working Dir   │  ←── 编辑文件    │              │
│   (工作区)       │                  │              │
└────────┬────────┘                  │              │
         │ git add                    │              │
         ↓                            │   Remote     │
┌─────────────────┐                  │   Repository │
│  Staging Area   │  ←── 准备提交    │   (远程仓库)  │
│   (暂存区)       │                  │              │
└────────┬────────┘                  │              │
         │ git commit                 │              │
         ↓                            └──────┬───────┘
┌─────────────────┐                         │
│ Local Repository│  ←── 本地历史           │ git push
│   (本地仓库)     │                         │
└────────┬────────┘                         │
         │ git push                         │
         └─────────────────────────────────→│
                                              │
         ←───────────────────────────────────┘
              git pull (从云端下载)
```

---

## ✅ 总结

**Git 同步 = 本地版本控制 + 云端备份 + 多设备同步**

设置完成后，你的角色系统可以：
- ✅ 在家里的电脑上修改
- ✅ 在公司的电脑上同步使用
- ✅ 不用担心文件丢失（云端有备份）
- ✅ 查看历史修改记录
- ✅ 和朋友分享、协作改进

---

**现在可以开始执行上面的设置步骤了！** 🚀

遇到任何问题，随时问我！
