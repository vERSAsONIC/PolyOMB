# A0012 VolatilityMarketMaker Skill æ¶æ„è§„åˆ’

> æ¶æ„å¸ˆè§’è‰² | æ—¥æœŸï¼š2026-02-17

---

## ğŸ“‹ è§„åˆ’æ¦‚è§ˆ

### ç›®æ ‡
åˆ›å»ºä¸€ä¸ªåŸºäº poly-maker æ ¸å¿ƒç®—æ³•çš„ PolyOMB Skillï¼Œå®ç°ï¼š
1. **æ ¸å¿ƒç®—æ³•**: ç§»æ¤ poly-maker çš„æ³¢åŠ¨ç‡åšå¸‚ç­–ç•¥
2. **æ•°æ®æº**: å¯¹æ¥æœ¬åœ° prediction-market-analysis å†å²æ•°æ®
3. **ç®¡ç†æ–¹å¼**: é‡‡ç”¨ OpenClaw Skill ç³»ç»Ÿçš„æŠ€æœ¯æ ˆå’Œç•Œé¢èŒƒå¼

### äº§å‡ºç‰©
æœ¬è§„åˆ’ç¡®è®¤åï¼Œå°†ç”Ÿæˆï¼š
- `00002_volatility_market_maker/` ç­–ç•¥æ–‡ä»¶å¤¹
- SKILL.md (OpenClaw æ ¼å¼) + strategy.yaml (PolyOMB æ ¼å¼)
- strategy.py (æ ¸å¿ƒç®—æ³•å®ç°)
- è¯´æ˜æ–‡æ¡£

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### 1. æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    subgraph "Skillç®¡ç†å±‚ (OpenClawèŒƒå¼)"
        A1[Skill Discovery]
        A2[Dependency Check]
        A3[Skill Registry]
    end
    
    subgraph "VolatilityMarketMaker Skill"
        B1[SKILL.md å®šä¹‰]
        B2[strategy.yaml é…ç½®]
        B3[strategy.py å®ç°]
        B4[Tests/è¯•è¿è¡Œ]
    end
    
    subgraph "æ•°æ®å±‚"
        C1[prediction-market-analysis<br/>Parquetæ•°æ®]
        C2[Data Adapter<br/>æ•°æ®é€‚é…å™¨]
        C3[å®æ—¶æ•°æ®æ¥å£<br/>Gamma API]
    end
    
    subgraph "æ‰§è¡Œå±‚"
        D1[æ¨¡æ‹Ÿäº¤æ˜“å¼•æ“]
        D2[å›æµ‹å¼•æ“]
        D3[å›¾è¡¨å¯è§†åŒ–]
    end
    
    A1 --> B1
    B1 --> B2
    B2 --> B3
    B3 --> C2
    C2 --> C1
    C2 --> C3
    B3 --> D1
    B3 --> D2
    D2 --> D3
```

### 2. æ–‡ä»¶ç»“æ„è§„åˆ’

```
PolyOMB_Skills/
â””â”€â”€ 00002_volatility_market_maker/
    â”œâ”€â”€ 00002_SKILL.md                    # OpenClaw æ ¼å¼ Skill å®šä¹‰
    â”œâ”€â”€ 00002_strategy.yaml               # PolyOMB ç­–ç•¥é…ç½®
    â”œâ”€â”€ 00002_strategy.py                 # ç­–ç•¥æ ¸å¿ƒå®ç°
    â”œâ”€â”€ 00002_adapter.py                  # æ•°æ®é€‚é…å™¨
    â”œâ”€â”€ 00002_backtest.py                 # å›æµ‹å¼•æ“å°è£…
    â”œâ”€â”€ 00002_volatility_market_maker.description.md  # è¯´æ˜æ–‡æ¡£
    â””â”€â”€ tests/
        â”œâ”€â”€ test_volatility_calc.py       # æ³¢åŠ¨ç‡è®¡ç®—æµ‹è¯•
        â”œâ”€â”€ test_order_pricing.py         # è®¢å•å®šä»·æµ‹è¯•
        â””â”€â”€ test_integration.py           # é›†æˆæµ‹è¯•
```

---

## ğŸ”§ æ ¸å¿ƒè®¾è®¡å†³ç­–

### å†³ç­– 1: åŒæ ¼å¼é…ç½®å…¼å®¹

| æ ¼å¼ | ç”¨é€” | ä¼˜å…ˆçº§ |
|------|------|--------|
| SKILL.md (OpenClaw) | Skill å‘ç°ã€ä¾èµ–å£°æ˜ã€LLM æç¤º | ä¸»è¦ |
| strategy.yaml (PolyOMB) | è¿è¡Œæ—¶é…ç½®ã€å‚æ•°ç®¡ç† | æ¬¡è¦ |

**ç†ç”±**: å…¼å®¹ OpenClaw ç”Ÿæ€ï¼ŒåŒæ—¶æ»¡è¶³ PolyOMB è¿è¡Œæ—¶éœ€æ±‚ã€‚

### å†³ç­– 2: æ•°æ®é€‚é…å™¨æ¨¡å¼

```python
class PredictionMarketDataAdapter:
    """
    é€‚é… prediction-market-analysis çš„ Parquet æ•°æ®
    è½¬æ¢ä¸º poly-maker æœŸæœ›çš„æ•°æ®æ ¼å¼
    """
    
    def load_market_data(self, market_id: str) -> pd.DataFrame:
        """ä» Parquet åŠ è½½å¸‚åœºå†å²æ•°æ®"""
        pass
    
    def calculate_volatility(self, df: pd.DataFrame, window: str = "3h") -> float:
        """è®¡ç®— N å°æ—¶æ³¢åŠ¨ç‡"""
        pass
    
    def get_order_book_snapshot(self, market_id: str, timestamp: datetime) -> dict:
        """è·å–ç‰¹å®šæ—¶é—´ç‚¹çš„è®¢å•ç°¿å¿«ç…§"""
        pass
```

**ç†ç”±**: éš”ç¦»æ•°æ®æºå˜åŒ–ï¼Œä¾¿äºåç»­åˆ‡æ¢åˆ°å®æ—¶ APIã€‚

### å†³ç­– 3: ç­–ç•¥æ‰§è¡Œæ¨¡å¼

| æ¨¡å¼ | ç”¨é€” | å®ç°æ–¹å¼ |
|------|------|----------|
| **Backtest æ¨¡å¼** | å†å²æ•°æ®å›æµ‹ | éå†å†å²æ•°æ®ï¼Œæ¨¡æ‹Ÿæ‰§è¡Œ |
| **Paper æ¨¡å¼** | æ¨¡æ‹Ÿäº¤æ˜“ | è¿æ¥æ¨¡æ‹Ÿè´¦æˆ·ï¼Œè™šæ‹Ÿèµ„é‡‘ |
| **Live æ¨¡å¼** | çœŸå®äº¤æ˜“ | è¿æ¥çœŸå® APIï¼ˆPhase 4ï¼‰ |

**ç†ç”±**: æ”¯æŒæ¸è¿›å¼éªŒè¯ï¼Œä»å›æµ‹åˆ°å®ç›˜ã€‚

---

## ğŸ“Š æ•°æ®æµè®¾è®¡

### å†å²æ•°æ®å›æµ‹æµç¨‹

```mermaid
sequenceDiagram
    participant User
    participant Skill as VolatilityMM Skill
    participant Adapter as Data Adapter
    participant Data as Parquet Data
    participant Engine as Backtest Engine
    
    User->>Skill: å¯åŠ¨å›æµ‹(market_id, date_range)
    Skill->>Adapter: è¯·æ±‚å†å²æ•°æ®
    Adapter->>Data: è¯»å– Parquet æ–‡ä»¶
    Data-->>Adapter: è¿”å›åŸå§‹æ•°æ®
    Adapter->>Adapter: è®¡ç®—æ³¢åŠ¨ç‡/è®¢å•ç°¿
    Adapter-->>Skill: è¿”å›ç»“æ„åŒ–æ•°æ®
    
    loop éå†æ—¶é—´åºåˆ—
        Skill->>Engine: æ‰§è¡Œç­–ç•¥é€»è¾‘
        Engine->>Engine: è®¡ç®—ä»·æ ¼/æ•°é‡
        Engine->>Engine: æ¨¡æ‹Ÿæˆäº¤
        Engine-->>Skill: è¿”å›äº¤æ˜“ç»“æœ
    end
    
    Skill->>Skill: ç”Ÿæˆå›æµ‹æŠ¥å‘Š
    Skill-->>User: è¿”å› PnL / å›¾è¡¨
```

### æ•°æ®ç»“æ„æ˜ å°„

| poly-maker åŸå­—æ®µ | prediction-market-analysis æ¥æº | è®¡ç®—æ–¹å¼ |
|------------------|-------------------------------|----------|
| `3_hour` (æ³¢åŠ¨ç‡) | trades.parquet | 3å°æ—¶ä»·æ ¼å˜åŒ–ç‡æ ‡å‡†å·® |
| `best_bid` | order book snapshot | æœ€é«˜ä¹°å•ä»·æ ¼ |
| `best_ask` | order book snapshot | æœ€ä½å–å•ä»·æ ¼ |
| `mid_price` | calculated | (best_bid + best_ask) / 2 |
| `tick_size` | markets.parquet | å¸‚åœºé…ç½® |

---

## ğŸ¨ ç•Œé¢è®¾è®¡ (OpenClaw èŒƒå¼)

### Skill ç®¡ç†ç•Œé¢è§„åˆ’

å‚è€ƒ OpenClaw çš„ Skill ç®¡ç†ï¼Œè®¾è®¡ä»¥ä¸‹ç•Œé¢ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PolyOMB Skill Manager                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å·²å®‰è£… Skills                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ“ˆ Volatilityâ”‚ â”‚ ğŸ“‰ MeanRev   â”‚ â”‚ âš–ï¸ Arbitrage â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   MarketMakerâ”‚ â”‚              â”‚ â”‚              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  [è¿è¡Œ] [é…ç½®]â”‚ â”‚  [è¿è¡Œ] [é…ç½®]â”‚ â”‚  [å®‰è£…]      â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  VolatilityMarketMaker è¯¦æƒ…                          â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  çŠ¶æ€: âœ… ä¾èµ–æ»¡è¶³                                    â”‚   â”‚
â”‚  â”‚  ç‰ˆæœ¬: 1.0.0                                         â”‚   â”‚
â”‚  â”‚  ä½œè€…: PolyOMB Team                                  â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  [â–¶ï¸ è¿è¡Œå›æµ‹] [ğŸ“Š æŸ¥çœ‹ç»“æœ] [âš™ï¸ å‚æ•°é…ç½®]            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ–¥ï¸ Poly-Maker-Run æ ¸å¿ƒç•Œé¢è®¾è®¡

### ç•Œé¢æ¦‚è§ˆ

**ç•Œé¢åç§°**: `poly-maker-run`  
**å¸ƒå±€**: å…¨å±ä¸‰åˆ—å“åº”å¼å¸ƒå±€  
**æŠ€æœ¯æ ˆ**: Streamlit (å‚è€ƒ Gnosis Agent å®ç°) + Plotly å›¾è¡¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”· Poly-Maker-Run - Volatility Market Maker Analysis                          [å…¨å±åˆ‡æ¢] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    ğŸ“Š ç­›é€‰å™¨         â”‚  â”‚    ğŸ“‹ Question åˆ—è¡¨          â”‚  â”‚    ğŸ“ˆ åˆ†æç»“æœ            â”‚  â”‚
â”‚  â”‚    (Filter Panel)    â”‚  â”‚    (Question List)           â”‚  â”‚    (Results Panel)       â”‚  â”‚
â”‚  â”‚    å®½åº¦: 20%         â”‚  â”‚    å®½åº¦: 30%                 â”‚  â”‚    å®½åº¦: 50%             â”‚  â”‚
â”‚  â”‚                      â”‚  â”‚                              â”‚  â”‚                          â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚                              â”‚  â”‚                          â”‚  â”‚
â”‚  â”‚ 1ï¸âƒ£ æ•°æ®æº            â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ å½“é€‰æ‹©å·¦ä¾§ Question æ—¶   â”‚  â”‚
â”‚  â”‚                      â”‚  â”‚ â”‚ ğŸ” æœç´¢ questions...     â”‚ â”‚  â”‚ å®æ—¶æ˜¾ç¤º Skill è®¡ç®—ç»“æœ  â”‚  â”‚
â”‚  â”‚ â—‹ Historical Data    â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚                          â”‚  â”‚
â”‚  â”‚   (Parquet)          â”‚  â”‚                              â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ â— å·²é€‰ä¸­            â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚  ğŸ“Š ä»·æ ¼æ³¢åŠ¨å›¾è¡¨      â”‚ â”‚  â”‚
â”‚  â”‚                      â”‚  â”‚ â”‚ âœ… Will Trump win 2024?  â”‚ â”‚  â”‚ â”‚  - å†å²ä»·æ ¼èµ°åŠ¿       â”‚ â”‚  â”‚
â”‚  â”‚ â—‹ Real-time API      â”‚  â”‚ â”‚    [2024 Politics]       â”‚ â”‚  â”‚ â”‚  - ä¹°å–æŒ‚å•æ·±åº¦       â”‚ â”‚  â”‚
â”‚  â”‚   (Gamma)            â”‚  â”‚ â”‚    â€¢ Yes: 0.65 â€¢ No: 0.35â”‚ â”‚  â”‚ â”‚  - æˆäº¤æ ‡è®°          â”‚ â”‚  â”‚
â”‚  â”‚   [æœªæ¥å¯ç”¨]         â”‚  â”‚ â”‚    [é€‰æ‹©å¹¶è¿è¡Œåˆ†æ]      â”‚ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                      â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚                          â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚                              â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ 2ï¸âƒ£ Market ç­›é€‰       â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚  ğŸ“ˆ ç­–ç•¥ä¿¡å·å›¾è¡¨      â”‚ â”‚  â”‚
â”‚  â”‚                      â”‚  â”‚ â”‚ â˜ Will ETH reach $5k?    â”‚ â”‚  â”‚ â”‚  - ä¹°å…¥/å–å‡ºä¿¡å·      â”‚ â”‚  â”‚
â”‚  â”‚ â˜‘ 2024 Politics      â”‚  â”‚ â”‚    [Crypto]              â”‚ â”‚  â”‚ â”‚  - æŒä»“å˜åŒ–          â”‚ â”‚  â”‚
â”‚  â”‚ â˜‘ Crypto             â”‚  â”‚ â”‚    â€¢ Yes: 0.42 â€¢ No: 0.58â”‚ â”‚  â”‚ â”‚  - PnL æ›²çº¿          â”‚ â”‚  â”‚
â”‚  â”‚ â˜ Sports             â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚ â˜‘ Tech               â”‚  â”‚                              â”‚  â”‚                          â”‚  â”‚
â”‚  â”‚                      â”‚  â”‚ ... (æ›´å¤š questions)        â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚                              â”‚  â”‚ â”‚  ğŸ“‹ äº¤æ˜“è®°å½•è¡¨æ ¼      â”‚ â”‚  â”‚
â”‚  â”‚ 3ï¸âƒ£ Question ç­›é€‰     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  - æ—¶é—´/ä»·æ ¼/ç±»å‹/æ•°é‡â”‚ â”‚  â”‚
â”‚  â”‚                      â”‚                                     â”‚ â”‚  - ç´¯è®¡ç›ˆäº          â”‚ â”‚  â”‚
â”‚  â”‚ [æœç´¢...           ] â”‚                                     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                      â”‚                                     â”‚                          â”‚  â”‚
â”‚  â”‚ çƒ­é—¨ Tags:           â”‚                                     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ [#Trump] [#BTC]     â”‚                                     â”‚ â”‚  âš™ï¸ ç­–ç•¥å‚æ•°é¢æ¿      â”‚ â”‚  â”‚
â”‚  â”‚ [#Election] [#AI]   â”‚                                     â”‚ â”‚  - æ­¢æŸ: -5%         â”‚ â”‚  â”‚
â”‚  â”‚                      â”‚                                     â”‚ â”‚  - æ­¢ç›ˆ: +3%         â”‚ â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                     â”‚ â”‚  - æ³¢åŠ¨ç‡é˜ˆå€¼: 0.15  â”‚ â”‚  â”‚
â”‚  â”‚ 4ï¸âƒ£ Outcome ç­›é€‰      â”‚                                     â”‚ â”‚  [ä¿®æ”¹å‚æ•°] [é‡è·‘]   â”‚ â”‚  â”‚
â”‚  â”‚                      â”‚                                     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚ â˜‘ Yes / Long         â”‚                                     â”‚                          â”‚  â”‚
â”‚  â”‚ â˜‘ No / Short         â”‚                                     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚                      â”‚                                     â”‚ â”‚  ğŸ“Š ç»Ÿè®¡æŒ‡æ ‡          â”‚ â”‚  â”‚
â”‚  â”‚ é«˜çº§: å¤šé€‰å…·ä½“é€‰é¡¹   â”‚                                     â”‚ â”‚  - æ€»æ”¶ç›Šç‡: +12.5%  â”‚ â”‚  â”‚
â”‚  â”‚ [å±•å¼€ â–¼]            â”‚                                     â”‚ â”‚  - å¤æ™®æ¯”ç‡: 1.85    â”‚ â”‚  â”‚
â”‚  â”‚                      â”‚                                     â”‚ â”‚  - æœ€å¤§å›æ’¤: -8.2%   â”‚ â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                     â”‚ â”‚  - èƒœç‡: 68%         â”‚ â”‚  â”‚
â”‚  â”‚ 5ï¸âƒ£ æ—¶é—´å‘¨æœŸ          â”‚                                     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                      â”‚                                     â”‚                          â”‚  â”‚
â”‚  â”‚ â—‹ å…¨ç”Ÿå‘½å‘¨æœŸ         â”‚                                     â”‚                          â”‚  â”‚
â”‚  â”‚ â— è‡ªå®šä¹‰åŒºé—´         â”‚                                     â”‚                          â”‚  â”‚
â”‚  â”‚                      â”‚                                     â”‚                          â”‚  â”‚
â”‚  â”‚ å¼€å§‹: [2024-01-01]  â”‚                                     â”‚                          â”‚  â”‚
â”‚  â”‚ ç»“æŸ: [2024-12-31]  â”‚                                     â”‚                          â”‚  â”‚
â”‚  â”‚                      â”‚                                     â”‚                          â”‚  â”‚
â”‚  â”‚ é¢„è®¾:               â”‚                                     â”‚                          â”‚  â”‚
â”‚  â”‚ [è¿‘7å¤©] [è¿‘30å¤©]    â”‚                                     â”‚                          â”‚  â”‚
â”‚  â”‚ [æœ¬å­£åº¦] [å…¨å¹´]     â”‚                                     â”‚                          â”‚  â”‚
â”‚  â”‚ [ç”Ÿå‘½å‘¨æœŸ]          â”‚                                     â”‚                          â”‚  â”‚
â”‚  â”‚                      â”‚                                     â”‚                          â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                     â”‚                          â”‚  â”‚
â”‚  â”‚ [ğŸ”„ åº”ç”¨ç­›é€‰]        â”‚                                     â”‚                          â”‚  â”‚
â”‚  â”‚ [é‡ç½®]               â”‚                                     â”‚                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ç»„ä»¶è¯¦ç»†è®¾è®¡

#### å·¦åˆ—ï¼šç­›é€‰å™¨é¢æ¿ (20%)

| ç»„ä»¶ | ç±»å‹ | åŠŸèƒ½ | æ•°æ®æ¥æº |
|------|------|------|----------|
| **æ•°æ®æºé€‰æ‹©** | Radio Button | åˆ‡æ¢ Historical/Realtime | ç¡¬ç¼–ç ï¼ŒRealtime æ ‡è®°ä¸º"[æœªæ¥å¯ç”¨]" |
| **Market å¤šé€‰** | Checkbox Group | æŒ‰å¸‚åœºç±»åˆ«ç­›é€‰ | ä» Parquet è¯»å– market è¡¨ categories |
| **Question æœç´¢** | Search Input + Tags | å…³é”®è¯æœç´¢ + çƒ­é—¨æ ‡ç­¾ | ä» Parquet è¯»å– question è¡¨ |
| **Outcome ç­›é€‰** | Checkbox + Dropdown | Yes/No æˆ–å…·ä½“é€‰é¡¹ | æ ¹æ® question åŠ¨æ€åŠ è½½ outcomes |
| **æ—¶é—´å‘¨æœŸ** | Radio + Date Picker + Presets | ç”Ÿå‘½å‘¨æœŸ/å…¨å¹´/è‡ªå®šä¹‰åŒºé—´ | ç”¨æˆ·è¾“å…¥ï¼Œè‡ªåŠ¨è¯†åˆ«æ•°æ®å¹´ä»½ |
| **æ“ä½œæŒ‰é’®** | Button Group | åº”ç”¨ç­›é€‰ / é‡ç½® | - |

**æ—¶é—´å‘¨æœŸé¢„è®¾é€»è¾‘**:
```python
class TimeRangePreset(Enum):
    LAST_7_DAYS = "è¿‘7å¤©"
    LAST_30_DAYS = "è¿‘30å¤©"
    THIS_QUARTER = "æœ¬å­£åº¦"
    FULL_YEAR = "å…¨å¹´"  # è‡ªåŠ¨æ ¹æ®å¸‚åœºæ•°æ®å¹´ä»½å†³å®š
    FULL_LIFECYCLE = "ç”Ÿå‘½å‘¨æœŸ"  # è¯¥ question çš„å…¨éƒ¨å†å²æ•°æ®

def get_date_range(preset: TimeRangePreset, market_data: pd.DataFrame) -> Tuple[datetime, datetime]:
    \"\"\"æ ¹æ®é¢„è®¾è¿”å›å¼€å§‹å’Œç»“æŸæ—¥æœŸ\"\"\"
    now = datetime.now()
    
    if preset == TimeRangePreset.LAST_7_DAYS:
        return now - timedelta(days=7), now
    elif preset == TimeRangePreset.LAST_30_DAYS:
        return now - timedelta(days=30), now
    elif preset == TimeRangePreset.THIS_QUARTER:
        quarter_start = datetime(now.year, (now.month - 1) // 3 * 3 + 1, 1)
        return quarter_start, now
    elif preset == TimeRangePreset.FULL_YEAR:
        # è‡ªåŠ¨æ£€æµ‹å¸‚åœºæ•°æ®çš„å¹´ä»½
        data_year = market_data['timestamp'].dt.year.mode()[0]  # å–ä¼—æ•°å¹´ä»½
        return datetime(data_year, 1, 1), datetime(data_year, 12, 31)
    elif preset == TimeRangePreset.FULL_LIFECYCLE:
        # ä½¿ç”¨è¯¥ question çš„å…¨éƒ¨å†å²æ•°æ®
        return market_data['timestamp'].min(), market_data['timestamp'].max()
```

**ç­›é€‰å™¨çŠ¶æ€ç®¡ç†**:
```python
@dataclass
class FilterState:
    data_source: Literal["historical", "realtime"] = "historical"
    selected_markets: List[str] = field(default_factory=list)
    search_query: str = ""
    selected_tags: List[str] = field(default_factory=list)
    selected_outcomes: List[str] = field(default_factory=lambda: ["Yes", "No"])
    time_mode: Literal["full", "custom"] = "full"
    start_date: Optional[datetime] = None
    end_date: Optional[datetime] = None
```

#### ä¸­åˆ—ï¼šQuestion åˆ—è¡¨ (35%)

| ç»„ä»¶ | ç±»å‹ | åŠŸèƒ½ |
|------|------|------|
| **æœç´¢æ¡†** | Text Input | åœ¨å·²ç­›é€‰ç»“æœä¸­å¿«é€Ÿæœç´¢ |
| **Question å¡ç‰‡** | Expandable Card | æ˜¾ç¤º question åŸºæœ¬ä¿¡æ¯ |
| **é€‰æ‹©æŒ‰é’®** | Button | é€‰ä¸­è¯¥ question è¿›è¡Œåˆ†æ |
| **å¤šé€‰æ”¯æŒ** | Checkbox | æ‰¹é‡é€‰æ‹©å¤šä¸ª questions |
| **æ’åºé€‰é¡¹** | Select | æŒ‰æµåŠ¨æ€§/æ—¶é—´/åç§°æ’åº |

**Question å¡ç‰‡ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Question Title              â”‚
â”‚    [Market Category]           â”‚
â”‚    â€¢ Outcome1: 0.65           â”‚
â”‚    â€¢ Outcome2: 0.35           â”‚
â”‚    æµåŠ¨æ€§: $1.2M | 24hæˆäº¤: 500â”‚
â”‚    [ğŸ” é€‰æ‹©å¹¶åˆ†æ]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å³åˆ—ï¼šåˆ†æç»“æœé¢æ¿ (40%)

| ç»„ä»¶ | ç±»å‹ | åŠŸèƒ½ | äº¤äº’ |
|------|------|------|------|
| **ä»·æ ¼å›¾è¡¨** | Plotly Chart | å†å²ä»·æ ¼èµ°åŠ¿ + è®¢å•ç°¿æ·±åº¦ | ç¼©æ”¾/å¹³ç§»/æ‚¬åœè¯¦æƒ… |
| **ç­–ç•¥ä¿¡å·å›¾** | Plotly Chart | ä¹°å…¥/å–å‡ºä¿¡å·æ ‡è®° + PnL | ä¸ä»·æ ¼å›¾è”åŠ¨ |
| **äº¤æ˜“è®°å½•è¡¨** | DataFrame Table | å®Œæ•´äº¤æ˜“å†å² | åˆ†é¡µ/æ’åº/å¯¼å‡º CSV |
| **å‚æ•°é¢æ¿** | Form | è°ƒæ•´ç­–ç•¥å‚æ•° | å®æ—¶é‡ç®— |
| **ç»Ÿè®¡æŒ‡æ ‡** | Metric Cards | å…³é”®ç»©æ•ˆæŒ‡æ ‡ | è‡ªåŠ¨æ›´æ–° |

---

### æ•°æ®æµè®¾è®¡

```mermaid
sequenceDiagram
    participant User
    participant UI as poly-maker-run UI
    participant Filter as Filter Engine
    participant Data as DataAdapter
    participant Parquet as Parquet Files
    participant Skill as VolatilityMM Skill
    participant Viz as Visualization

    User->>UI: æ‰“å¼€ poly-maker-run
    UI->>Data: åˆå§‹åŒ–åŠ è½½ markets/questions
    Data->>Parquet: è¯»å–å…ƒæ•°æ®
    Parquet-->>Data: è¿”å› markets/questions åˆ—è¡¨
    Data-->>UI: æ¸²æŸ“ç­›é€‰å™¨é¢æ¿

    User->>UI: è®¾ç½®ç­›é€‰æ¡ä»¶
    UI->>Filter: åº”ç”¨ç­›é€‰
    Filter->>Data: æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„ questions
    Data->>Parquet: æ‰§è¡Œè¿‡æ»¤æŸ¥è¯¢
    Parquet-->>Data: è¿”å›ç­›é€‰ç»“æœ
    Data-->>UI: æ›´æ–° Question åˆ—è¡¨

    User->>UI: é€‰æ‹© Question
    UI->>Data: åŠ è½½è¯¥ question å†å²æ•°æ®
    Data->>Parquet: è¯»å– trades/orderbook
    Parquet-->>Data: è¿”å›æ—¶é—´åºåˆ—æ•°æ®
    Data-->>Skill: æ‰§è¡Œç­–ç•¥è®¡ç®—
    Skill-->>Data: è¿”å›äº¤æ˜“ä¿¡å·/PnL
    Data-->>Viz: ç”Ÿæˆå›¾è¡¨
    Viz-->>UI: æ¸²æŸ“ç»“æœé¢æ¿
```

---

### æŠ€æœ¯å®ç°æ–¹æ¡ˆ

#### Streamlit å¸ƒå±€ä»£ç ç»“æ„

```python
import streamlit as st
import plotly.graph_objects as go
from plotly.subplots import make_subplots

# é¡µé¢é…ç½®
st.set_page_config(
    page_title="Poly-Maker-Run",
    layout="wide",  # å…¨å±å®½å¸ƒå±€
    initial_sidebar_state="collapsed"
)

# è‡ªå®šä¹‰ CSS å®ç°ä¸‰åˆ—å›ºå®šæ¯”ä¾‹
st.markdown("""
<style>
    .main .block-container {
        max-width: 100%;
        padding: 0;
    }
    .filter-column {
        background-color: #f8f9fa;
        padding: 1rem;
        border-right: 1px solid #dee2e6;
        height: 100vh;
        overflow-y: auto;
    }
    .question-column {
        background-color: #ffffff;
        padding: 1rem;
        border-right: 1px solid #dee2e6;
        height: 100vh;
        overflow-y: auto;
    }
    .result-column {
        background-color: #ffffff;
        padding: 1rem;
        height: 100vh;
        overflow-y: auto;
    }
</style>
""", unsafe_allow_html=True)

# ä¸‰åˆ—å¸ƒå±€ (20% - 30% - 50%)
col_filter, col_question, col_result = st.columns([0.20, 0.30, 0.50])

# å·¦åˆ—ï¼šç­›é€‰å™¨
with col_filter:
    st.markdown("<div class='filter-column'>", unsafe_allow_html=True)
    render_filter_panel()
    st.markdown("</div>", unsafe_allow_html=True)

# ä¸­åˆ—ï¼šQuestion åˆ—è¡¨
with col_question:
    st.markdown("<div class='question-column'>", unsafe_allow_html=True)
    render_question_list()
    st.markdown("</div>", unsafe_allow_html=True)

# å³åˆ—ï¼šåˆ†æç»“æœ
with col_result:
    st.markdown("<div class='result-column'>", unsafe_allow_html=True)
    render_result_panel()
    st.markdown("</div>", unsafe_allow_html=True)
```

#### å…³é”®ç»„ä»¶å®ç°

**1. ç­›é€‰å™¨çŠ¶æ€ç®¡ç† (Session State)**
```python
# åˆå§‹åŒ–ç­›é€‰å™¨çŠ¶æ€
if 'filters' not in st.session_state:
    st.session_state.filters = FilterState()

# æ•°æ®æºé€‰æ‹©
data_source = st.radio(
    "ğŸ“Š æ•°æ®æº",
    options=["historical", "realtime"],
    format_func=lambda x: {
        "historical": "ğŸ“ Historical Data (Parquet)",
        "realtime": "ğŸŒ Real-time API (Gamma) [æœªæ¥å¯ç”¨]"
    }[x],
    key="data_source"
)
```

**2. Question å¡ç‰‡ç»„ä»¶**
```python
def render_question_card(question: QuestionMeta):
    """æ¸²æŸ“å•ä¸ª Question å¡ç‰‡"""
    with st.container():
        col1, col2 = st.columns([0.8, 0.2])
        with col1:
            st.markdown(f"**{question.title}**")
            st.caption(f"[{question.category}] æµåŠ¨æ€§: ${question.liquidity:,.0f}")
            # Outcomes ä»·æ ¼
            for outcome in question.outcomes:
                st.markdown(f"â€¢ {outcome.name}: {outcome.price:.2f}")
        with col2:
            if st.button("ğŸ” åˆ†æ", key=f"btn_{question.id}"):
                st.session_state.selected_question = question
                st.rerun()
        st.divider()
```

**3. ç»“æœé¢æ¿å›¾è¡¨**
```python
def render_price_chart(df: pd.DataFrame):
    """æ¸²æŸ“ä»·æ ¼å’Œç­–ç•¥ä¿¡å·ç»„åˆå›¾"""
    fig = make_subplots(
        rows=3, cols=1,
        shared_xaxes=True,
        vertical_spacing=0.05,
        row_heights=[0.5, 0.25, 0.25],
        subplot_titles=("Price & Orders", "Position", "PnL")
    )
    
    # ä»·æ ¼çº¿
    fig.add_trace(go.Scatter(x=df.time, y=df.price, name="Price"), row=1, col=1)
    
    # ä¹°å…¥/å–å‡ºä¿¡å·
    buy_signals = df[df.signal == "BUY"]
    sell_signals = df[df.signal == "SELL"]
    fig.add_trace(go.Scatter(x=buy_signals.time, y=buy_signals.price, 
                            mode="markers", name="Buy", marker=dict(color="green", size=10)), row=1, col=1)
    fig.add_trace(go.Scatter(x=sell_signals.time, y=sell_signals.price, 
                            mode="markers", name="Sell", marker=dict(color="red", size=10)), row=1, col=1)
    
    # Position å’Œ PnL...
    
    fig.update_layout(height=800, showlegend=True)
    st.plotly_chart(fig, use_container_width=True)
```

---

### ä¸ Skill ç³»ç»Ÿçš„é›†æˆ

```mermaid
graph LR
    subgraph "poly-maker-run UI"
        A1[ç­›é€‰å™¨é¢æ¿]
        A2[Questionåˆ—è¡¨]
        A3[ç»“æœé¢æ¿]
    end
    
    subgraph "VolatilityMM Skill"
        B1[strategy.yaml é…ç½®]
        B2[strategy.py æ‰§è¡Œ]
        B3[DataAdapter é€‚é…]
    end
    
    subgraph "æ•°æ®å±‚"
        C1[Parquet å†å²æ•°æ®]
        C2[Gamma API å®æ—¶æ•°æ®]
    end
    
    A1 --> B2
    A2 --> B2
    B2 --> B3
    B3 --> C1
    B3 -.-> C2
    B2 --> A3
```

**é›†æˆç‚¹**:
1. UI é€šè¿‡ `strategy.yaml` è¯»å–é»˜è®¤å‚æ•°
2. UI å°†ç”¨æˆ·è°ƒæ•´çš„å‚æ•°ä¼ é€’ç»™ Skill
3. Skill è¿”å›çš„ trades/PnL æ•°æ®ç›´æ¥é©±åŠ¨å¯è§†åŒ–
4. æ”¯æŒ"ä¸€é”®å¯¼å‡º Skill é…ç½®"åŠŸèƒ½

---

### æ‰©å±•æ€§è€ƒè™‘

| æœªæ¥éœ€æ±‚ | é¢„ç•™æ‰©å±•ç‚¹ |
|----------|-----------|
| **å®æ—¶æ•°æ®æº** | æ•°æ®æº radio button å·²é¢„ç•™æ¥å£ |
| **å¤š Skill å¯¹æ¯”** | ç»“æœé¢æ¿æ”¯æŒå¤šæ ‡ç­¾é¡µ |
| **æ‰¹é‡å›æµ‹** | Question åˆ—è¡¨æ”¯æŒå¤šé€‰ |
| **å¯¼å‡ºæŠ¥å‘Š** | ç»“æœé¢æ¿æ·»åŠ å¯¼å‡ºæŒ‰é’® |
| **å‚æ•°ä¼˜åŒ–** | å‚æ•°é¢æ¿æ”¯æŒç½‘æ ¼æœç´¢ |

---

### å›è¯•è¿è¡Œç•Œé¢ (æ—§ç‰ˆä¿ç•™)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VolatilityMarketMaker - å›æµ‹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å‚æ•°é…ç½®                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ å¸‚åœº ID     â”‚ å¼€å§‹æ—¥æœŸ    â”‚ ç»“æŸæ—¥æœŸ    â”‚               â”‚
â”‚  â”‚ [________] â”‚ [________] â”‚ [________] â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ æ­¢æŸé˜ˆå€¼    â”‚ æ­¢ç›ˆé˜ˆå€¼    â”‚ æ³¢åŠ¨ç‡é˜ˆå€¼  â”‚               â”‚
â”‚  â”‚ [-5%    ]  â”‚ [+3%    ]  â”‚ [0.15   ]  â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                             â”‚
â”‚  [å¼€å§‹å›æµ‹]                                                  â”‚
â”‚                                                             â”‚
â”‚  è¿›åº¦: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 65%                   â”‚
â”‚                                                             â”‚
â”‚  å®æ—¶å›¾è¡¨                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Price / PnL / Trades æŠ˜çº¿å›¾                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” ä¾èµ–å£°æ˜ (SKILL.md Frontmatter)

```yaml
---
name: volatility-market-maker
description: "åŸºäºæ³¢åŠ¨ç‡çš„å¸‚åœºåšå¸‚ç­–ç•¥ï¼Œæ”¹ç¼–è‡ª poly-maker æ ¸å¿ƒç®—æ³•"
metadata:
  polyomb:
    emoji: "ğŸ“ˆ"
    version: "1.0.0"
    author: "PolyOMB Team"
    source: "adapted"
    origin_repo: "https://github.com/xxx/poly-maker"
    requires:
      data: 
        - type: "parquet"
          path: "prediction-market-analysis/data"
          description: "å†å²äº¤æ˜“æ•°æ®"
      python_packages:
        - "pandas>=2.0"
        - "pyarrow>=14.0"
        - "sortedcontainers"
      config:
        - "POLYOMB_DATA_PATH"
    params:
      - name: "stop_loss_threshold"
        type: "float"
        default: -5.0
        description: "æ­¢æŸç™¾åˆ†æ¯”é˜ˆå€¼"
        unit: "%"
      - name: "take_profit_threshold"
        type: "float"
        default: 3.0
        description: "æ­¢ç›ˆç™¾åˆ†æ¯”é˜ˆå€¼"
        unit: "%"
      - name: "volatility_threshold"
        type: "float"
        default: 0.15
        description: "3å°æ—¶æ³¢åŠ¨ç‡é˜ˆå€¼"
      - name: "max_position_size"
        type: "int"
        default: 250
        description: "æœ€å¤§æŒä»“æ•°é‡"
      - name: "trade_size"
        type: "int"
        default: 50
        description: "å•æ¬¡äº¤æ˜“æ•°é‡"
---
```

---

## ğŸ“ æ ¸å¿ƒç®—æ³•ç§»æ¤æ–¹æ¡ˆ

### ç§»æ¤æ¸…å•

| poly-maker åŸæ¨¡å— | Skill å®ç° | ä¿®æ”¹ç‚¹ |
|------------------|-----------|--------|
| `trading.py::perform_trade()` | `strategy.py::on_tick()` | æ”¹ä¸ºäº‹ä»¶é©±åŠ¨ |
| `trading.py::get_order_prices()` | `strategy.py::_calculate_prices()` | ä¿ç•™æ ¸å¿ƒé€»è¾‘ |
| `poly_data/data_processing.py` | `adapter.py` | é€‚é… Parquet æ•°æ® |
| `poly_data/data_utils.py` | `adapter.py::DataLoader` | é‡å†™æ•°æ®åŠ è½½ |
| Google Sheets é…ç½® | `strategy.yaml` + UI é…ç½® | æ”¹ä¸º YAML/ç•Œé¢é…ç½® |

### å…³é”®ç®—æ³•ä¿ç•™

```python
# 1. æ³¢åŠ¨ç‡æ£€æŸ¥ (æ ¸å¿ƒé£æ§)
if row['3_hour'] > params['volatility_threshold']:
    # é«˜æ³¢åŠ¨æ—¶åœæ­¢äº¤æ˜“
    
# 2. åŠ¨æ€å®šä»·é€»è¾‘
bid_price, ask_price = get_order_prices(
    best_bid, best_bid_size, top_bid, 
    best_ask, best_ask_size, top_ask, 
    avgPrice, row
)

# 3. æ­¢æŸé€»è¾‘
if pnl < params['stop_loss_threshold'] and spread <= params['spread_threshold']:
    # è§¦å‘æ­¢æŸ
    
# 4. æ­¢ç›ˆé€»è¾‘  
tp_price = avgPrice + (avgPrice * params['take_profit_threshold']/100)
```

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
- `test_volatility_calc.py`: æµ‹è¯•æ³¢åŠ¨ç‡è®¡ç®—å‡†ç¡®æ€§
- `test_order_pricing.py`: æµ‹è¯•è®¢å•å®šä»·é€»è¾‘
- `test_risk_management.py`: æµ‹è¯•æ­¢æŸ/æ­¢ç›ˆè§¦å‘

### é›†æˆæµ‹è¯•
- `test_backtest_flow.py`: æµ‹è¯•å®Œæ•´å›æµ‹æµç¨‹
- `test_data_adapter.py`: æµ‹è¯•æ•°æ®é€‚é…å™¨

### éªŒè¯æ•°æ®
ä½¿ç”¨ prediction-market-analysis ä¸­çš„å·²çŸ¥å¸‚åœºæ•°æ®éªŒè¯ï¼š
- é€‰æ‹© 3-5 ä¸ªé«˜æµåŠ¨æ€§å¸‚åœº
- å¯¹æ¯” Skill è¾“å‡ºä¸åŸå§‹ poly-maker é¢„æœŸè¡Œä¸º

---

## ğŸš€ å®ç°è·¯çº¿å›¾

### Phase 1: æ ¸å¿ƒç§»æ¤ (1-2 å¤©)
- [ ] åˆ›å»º Skill æ–‡ä»¶å¤¹ç»“æ„
- [ ] ç¼–å†™ SKILL.md å’Œ strategy.yaml
- [ ] ç§»æ¤æ ¸å¿ƒç®—æ³•åˆ° strategy.py
- [ ] å®ç°åŸºç¡€ DataAdapter

### Phase 2: å›æµ‹é›†æˆ (2-3 å¤©)
- [ ] å®ç° BacktestEngine å°è£…
- [ ] è¿æ¥ Parquet æ•°æ®æº
- [ ] éªŒè¯å›æµ‹ç»“æœä¸€è‡´æ€§
- [ ] ç¼–å†™æµ‹è¯•ç”¨ä¾‹

### Phase 3: ç•Œé¢å¼€å‘ (3-5 å¤©)
- [ ] Skill ç®¡ç†ç•Œé¢
- [ ] å›è¯•è¿è¡Œç•Œé¢
- [ ] ç»“æœå›¾è¡¨å±•ç¤º
- [ ] å‚æ•°é…ç½®ç•Œé¢

### Phase 4: ä¼˜åŒ–å®Œå–„ (2-3 å¤©)
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] æ–‡æ¡£å®Œå–„
- [ ] å¼‚å¸¸å¤„ç†
- [ ] ä»£ç å®¡æŸ¥

---

## âš ï¸ é£é™©ä¸ç¼“è§£

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| æ•°æ®æºæ ¼å¼ä¸åŒ¹é… | é«˜ | æå‰éªŒè¯ Parquet schema |
| ç®—æ³•ç§»æ¤è¯¯å·® | é«˜ | ä¿ç•™åŸå§‹ç®—æ³•å¯¹ç…§æµ‹è¯• |
| æ€§èƒ½é—®é¢˜ (50GBæ•°æ®) | ä¸­ | å®ç°æ•°æ®åˆ†ç‰‡å’Œç¼“å­˜ |
| OpenClaw å…¼å®¹æ€§é—®é¢˜ | ä¸­ | ä½¿ç”¨æ ‡å‡† Frontmatter æ ¼å¼ |

---

## âœ… ç¡®è®¤æ¸…å• (å·²æ›´æ–°)

### ç”¨æˆ·ç¡®è®¤é¡¹

| # | é¡¹ç›® | çŠ¶æ€ | è¯´æ˜ |
|---|------|------|------|
| 1 | **ç•Œé¢åˆ—æ¯”ä¾‹** | âœ… å·²ç¡®è®¤ | `20% - 30% - 50%` (ç­›é€‰å™¨-åˆ—è¡¨-ç»“æœ) |
| 2 | **ç»“æœé¢æ¿ç»„ä»¶** | âœ… å·²ç¡®è®¤ | ä»·æ ¼å›¾ã€ä¿¡å·å›¾ã€äº¤æ˜“è¡¨ã€å‚æ•°é¢æ¿ã€ç»Ÿè®¡æŒ‡æ ‡ |
| 3 | **æ—¶é—´å‘¨æœŸé¢„è®¾** | âœ… å·²ç¡®è®¤ | è¿‘7å¤©ã€è¿‘30å¤©ã€æœ¬å­£åº¦ã€**å…¨å¹´**ã€**ç”Ÿå‘½å‘¨æœŸ** |
| 4 | **å…¨å¹´é¢„è®¾é€»è¾‘** | âœ… å·²ç¡®è®¤ | è‡ªåŠ¨æ£€æµ‹ market æ•°æ®å¹´ä»½ï¼Œä½¿ç”¨è¯¥å¹´å…¨å¹´ |
| 5 | **ç”Ÿå‘½å‘¨æœŸé¢„è®¾** | âœ… å·²ç¡®è®¤ | ä½¿ç”¨è¯¥ question çš„å…¨éƒ¨å†å²æ•°æ® |
| 6 | **æ‰¹é‡å¯¹æ¯”åˆ†æ** | â¸ï¸ å»¶å | æš‚ä¸å®ç° |

### å¾…ç¡®è®¤é¡¹ (æ¶æ„å¸ˆâ†’ç”¨æˆ·) - å…¨éƒ¨ç¡®è®¤ âœ…

| # | é¡¹ç›® | ç”¨æˆ·å›å¤ | çŠ¶æ€ |
|---|------|----------|------|
| 1 | **æ•°æ®æ¥æº** | `smb://MM2018._smb._tcp.local/liuqiong/prediction-market-analysis/data` | âœ… |
| 2 | **ç®—æ³•èŒƒå›´** | **æ ¸å¿ƒåšå¸‚é€»è¾‘ï¼Œä¸å« position merging** | âœ… |
| 3 | **ç•Œé¢ä¼˜å…ˆçº§** | **é€‰é¡¹A - Phase 1 å®ç°ä¸‰åˆ—ç•Œé¢** | âœ… |
| 4 | **æµ‹è¯•æ•°æ®** | **0x218919622a6132646d149021008659d834927b2b81005a92a54b38d781b0a56f** | âœ… |
| 5 | **å‚æ•°é»˜è®¤å€¼** | **ä½¿ç”¨åŸæœ‰é€»è¾‘é»˜è®¤å€¼** | âœ… |

#### æµ‹è¯•å¸‚åœºè¯¦æƒ…
- **Market ID**: `0x218919622a6132646d149021008659d834927b2b81005a92a54b38d781b0a56f`
- **ç”¨é€”**: éªŒè¯ Skill å›æµ‹ç»“æœä¸é¢„æœŸè¡Œä¸ºä¸€è‡´æ€§
- **æ•°æ®æ¥æº**: SMB æŒ‚è½½çš„ prediction-market-analysis Parquet æ–‡ä»¶

#### å‚æ•°é»˜è®¤å€¼ (æ¥è‡ªåŸæœ‰é€»è¾‘)
- **æ­¢æŸé˜ˆå€¼**: -5%
- **æ­¢ç›ˆé˜ˆå€¼**: +3%
- **æ³¢åŠ¨ç‡é˜ˆå€¼**: 0.15
- **æœ€å¤§æŒä»“**: 250
- **äº¤æ˜“æ•°é‡**: 50
- **Note**: ç¨‹åºæµ‹è¯•åå¯æ ¹æ®å›æµ‹ç»“æœè°ƒæ•´

#### å…³äº SMB æ•°æ®è·¯å¾„çš„æ¶æ„è€ƒè™‘

**è·¯å¾„**: `smb://MM2018._smb._tcp.local/liuqiong/prediction-market-analysis/data`

**DataAdapter å®ç°æ–¹æ¡ˆ**:
```python
import subprocess
import os
from pathlib import Path

class SMBDataAdapter:
    \"\"\"æ”¯æŒ SMB ç½‘ç»œè·¯å¾„çš„æ•°æ®é€‚é…å™¨\"\"\"
    
    def __init__(self, smb_url: str, mount_point: str = "/mnt/prediction-data"):
        self.smb_url = smb_url
        self.mount_point = Path(mount_point)
        self._is_mounted = False
    
    def mount(self):
        \"\"\"æŒ‚è½½ SMB å…±äº«\"\"\"
        if not self.mount_point.exists():
            self.mount_point.mkdir(parents=True, exist_ok=True)
        
        # macOS: ä½¿ç”¨ mount_smbfs
        # Linux: ä½¿ç”¨ mount -t cifs
        cmd = f"mount_smbfs {self.smb_url} {self.mount_point}"
        subprocess.run(cmd, shell=True, check=True)
        self._is_mounted = True
    
    def read_parquet(self, relative_path: str) -> pd.DataFrame:
        \"\"\"è¯»å– Parquet æ–‡ä»¶\"\"\"
        if not self._is_mounted:
            self.mount()
        full_path = self.mount_point / relative_path
        return pd.read_parquet(full_path)
```

**é…ç½®é¡¹**:
```yaml
# strategy.yaml
config:
  data_source:
    type: "smb"
    url: "smb://MM2018._smb._tcp.local/liuqiong/prediction-market-analysis/data"
    mount_point: "/mnt/prediction-data"  # å¯é…ç½®
    auto_mount: true
```

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [R0002 é¡¹ç›®B-OpenClaw Skillç³»ç»Ÿæ·±åº¦åˆ†æ.md](../R0002%20é¡¹ç›®B-OpenClaw%20Skillç³»ç»Ÿæ·±åº¦åˆ†æ.md)
- [A0011 PolyOMB_Skills æ–‡ä»¶å¤¹è¯´æ˜.md](../A0011%20PolyOMB_Skills%20æ–‡ä»¶å¤¹è¯´æ˜.md)
- poly-maker æºç : `CodeLib/00017/`
- prediction-market-analysis: æœ¬åœ°æ•°æ®é›†

---

**è§„åˆ’ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2026-02-17  
**çŠ¶æ€**: å¾…ç¡®è®¤
